{"editor":{"id":"61f178bc-18a3-44f6-b9f2-819321aca469","locked":false,"offsetX":21,"offsetY":-56,"zoom":100,"gridSize":0,"layers":[{"id":"f198d948-42b5-4cc2-8b11-fe072af4deeb","type":"diagram-links","isSvg":true,"transformed":true,"models":{"bc53db9c-2990-4adb-a769-d4056111084a":{"id":"bc53db9c-2990-4adb-a769-d4056111084a","type":"default","selected":false,"source":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","sourcePort":"e61bae71-f429-4528-87b6-484c45c22448","target":"cf5d2e26-5a50-4ff4-8b8f-43c582f1c655","targetPort":"b3b9256e-7569-45f3-900a-c8c9a447bd32","points":[{"id":"d0ce1b54-3c4d-46e0-a066-3175d879911b","type":"point","x":1311.1500244140625,"y":498},{"id":"7b8f5a97-b872-498a-b504-7cc7299f2bcf","type":"point","x":1369.5,"y":496.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"3bec2ca2-4ba0-4cf7-bca3-10e5927b6a13":{"id":"3bec2ca2-4ba0-4cf7-bca3-10e5927b6a13","type":"default","selected":false,"source":"3680762a-e4d0-4a2f-8315-22db96c2f120","sourcePort":"a29a2c0d-b3fc-40a6-842c-1f5d96080b9d","target":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","targetPort":"3a10bb5a-c8c3-4606-aa12-0abbf45f5771","points":[{"id":"0183dc77-7ce0-447c-a3e5-664ab43de86c","type":"point","x":385.5,"y":620.5},{"id":"22b8fc70-1e0f-4842-9c27-1689331b6de4","type":"point","x":445.5,"y":602}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"73049d8b-e78e-42b2-a97e-45a07d92c9da":{"id":"73049d8b-e78e-42b2-a97e-45a07d92c9da","type":"default","selected":false,"source":"81c8302b-ddaf-4608-a2c2-d62e254e54d6","sourcePort":"2dc5ddb5-bc0e-49da-a57b-c02099e38040","target":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","targetPort":"8c44b2d0-efee-4605-9094-88c716eb2c72","points":[{"id":"1e9a82f6-5e43-4e11-913e-6d250471045d","type":"point","x":383.5,"y":379.5},{"id":"fb27b43e-1db8-493a-9f82-2f4f863b4a9a","type":"point","x":445.5,"y":394}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"}}},{"id":"099b6333-8ae3-4c4a-a3eb-d861374a1159","type":"diagram-nodes","isSvg":false,"transformed":true,"models":{"81c8302b-ddaf-4608-a2c2-d62e254e54d6":{"id":"81c8302b-ddaf-4608-a2c2-d62e254e54d6","type":"basic.input","selected":false,"x":290,"y":353,"ports":[{"id":"2dc5ddb5-bc0e-49da-a57b-c02099e38040","type":"port.output","x":376,"y":372,"name":"input-out","alignment":"right","parentNode":"81c8302b-ddaf-4608-a2c2-d62e254e54d6","links":["73049d8b-e78e-42b2-a97e-45a07d92c9da"],"in":false,"label":"Img","hideLabel":true}],"data":{"name":"Img"}},"3680762a-e4d0-4a2f-8315-22db96c2f120":{"id":"3680762a-e4d0-4a2f-8315-22db96c2f120","type":"basic.input","selected":false,"x":292,"y":594,"ports":[{"id":"a29a2c0d-b3fc-40a6-842c-1f5d96080b9d","type":"port.output","x":378,"y":613,"name":"input-out","alignment":"right","parentNode":"3680762a-e4d0-4a2f-8315-22db96c2f120","links":["3bec2ca2-4ba0-4cf7-bca3-10e5927b6a13"],"in":false,"label":"Enable","hideLabel":true}],"data":{"name":"Enable"}},"cf5d2e26-5a50-4ff4-8b8f-43c582f1c655":{"id":"cf5d2e26-5a50-4ff4-8b8f-43c582f1c655","type":"basic.output","selected":false,"x":1361,"y":470,"ports":[{"id":"b3b9256e-7569-45f3-900a-c8c9a447bd32","type":"port.input","x":1362,"y":489,"name":"output-in","alignment":"left","parentNode":"cf5d2e26-5a50-4ff4-8b8f-43c582f1c655","links":["bc53db9c-2990-4adb-a769-d4056111084a"],"in":true,"label":"output-in","hideLabel":true}],"data":{"name":"Out"}},"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e":{"id":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","type":"basic.code","selected":false,"x":437,"y":136,"ports":[{"id":"8c44b2d0-efee-4605-9094-88c716eb2c72","type":"port.input","x":438,"y":386.5,"name":"Img","alignment":"left","parentNode":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","links":["73049d8b-e78e-42b2-a97e-45a07d92c9da"],"in":true,"label":"Img","hideLabel":false},{"id":"3a10bb5a-c8c3-4606-aa12-0abbf45f5771","type":"port.input","x":438,"y":594.5,"name":"Enable","alignment":"left","parentNode":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","links":["3bec2ca2-4ba0-4cf7-bca3-10e5927b6a13"],"in":true,"label":"Enable","hideLabel":false},{"id":"e61bae71-f429-4528-87b6-484c45c22448","type":"port.output","x":1303.6500244140625,"y":490.5,"name":"Out","alignment":"right","parentNode":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","links":["bc53db9c-2990-4adb-a769-d4056111084a"],"in":false,"label":"Out","hideLabel":false}],"data":{"code":"import cv2\nimport numpy as np\nimport time\n\nclassName = []\nclassesFile = 'utils/models/yolov3/yolov3.txt'\n\nwith open(classesFile,'rt') as f:\n    className = f.read().rstrip('\\n').split('\\n')\n\ndef findObjects(outputs, img):\n\n    confThreshold = 0.3\n    nmsThreshold = 0.3\n    hT, wT, cT = img.shape\n    bbox = []\n    classIds = []\n    confs = []\n\n    for output in outputs:\n    \n        for det in output:\n            scores = det[5:]\n            classId = np.argmax(scores)\n            confidence = scores[classId]\n            if confidence > confThreshold:\n                w,h = int(det[2] * wT), int(det[3] * hT)\n                x,y = int((det[0]*wT) - w/2), int((det[1]*hT) - h/2)\n                bbox.append([x,y,w,h])\n                classIds.append(classId)\n                confs.append(float(confidence))\n    \n    indices = cv2.dnn.NMSBoxes(bbox, confs, confThreshold, nmsThreshold)\n    \n    for i in range(len(indices)):\n        box = bbox[i]\n        x,y,w,h = box[0],box[1],box[2],box[3]\n        cv2.rectangle(img,(x,y),(x+w, y+h),(255,0,255),2)\n        cv2.putText(img,f'{className[classIds[i]].upper()} {int(confs[i]*100)}%',\n                    (x,y-10),cv2.FONT_HERSHEY_SIMPLEX, 0.6, (255,0,255),2)\n           \ndef main(inputs, outputs, parameters, synchronise):\n    auto_enable = True\n    try:\n        enable = inputs.read_number(\"Enable\")\n    except Exception:\n        auto_enable = True\n    \n    whT = 320\n\n    modelConfiguration = 'utils/models/yolov3/yolov3-tiny.cfg'\n    modelWeights = 'utils/models/yolov3/yolov3-tiny.weights'\n\n    net = cv2.dnn.readNetFromDarknet(modelConfiguration,modelWeights)\n    net.setPreferableBackend(cv2.dnn.DNN_BACKEND_OPENCV)\n    net.setPreferableTarget(cv2.dnn.DNN_TARGET_CPU)\n\n    while(auto_enable or inputs.read_number('Enable')):\n        frame = inputs.read_image(\"Img\")\n        \n        if frame is None:\n            continue\n\n        #converting img to blob\n        blob = cv2.dnn.blobFromImage(frame, 1/255,(whT,whT),[0,0,0],1, crop = False)\n\n        #Passing blob to network\n        net.setInput(blob)\n\n        layerNames = net.getLayerNames()\n        outputNames = []\n        outLayers = net.getUnconnectedOutLayers()\n        \n        for i in range(len(outLayers)):\n            for j in range(len(outLayers[i])):\n                outputNames.append(layerNames[outLayers[i][j] - 1])\n\n        #forward Pass\n        results = net.forward(outputNames)\n        findObjects(results,frame)\n\n        outputs.share_image(\"Out\", frame)\n","frequency":"30","params":[],"ports":{"in":[{"name":"Img"},{"name":"Enable"}],"out":[{"name":"Out"}]},"size":{"width":"825px","height":"586px"}}}}}]},"version":"3.0","package":{"name":"ObjectDetector","version":"2.0.0","description":"Detects Objects in an Image","author":"Faizan Ahmed","image":"data:image/svg+xml;base64,PHN2ZyBpZD0iQ2FwYV8xIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA1MTAgNTEwIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMCA1MTAiIHdpZHRoPSI1MTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgaWQ9IlhNTElEXzI3MF8iPjxwYXRoIGlkPSJYTUxJRF8zOTdfIiBkPSJtMjQwIDB2NzUuNjJsNy41IDYuMjk3IDcuNS02LjkxNyAzLjY3My0zNi4xMDYtMy42NzMtMzguODk0Yy01LjI0NiAwLTkuNzU0IDAtMTUgMHoiIGZpbGw9IiNlNjM5NTAiLz48cGF0aCBpZD0iWE1MSURfMzYxXyIgZD0ibTI3MCAwYy01LjI0NiAwLTkuNzU0IDAtMTUgMHY3NWw3LjUgNi45MTYgNy41LTYuMjk3YzAtMTguOTg5IDAtNjMuNDM2IDAtNzUuNjE5eiIgZmlsbD0iI2NkMDAwMCIvPjxwYXRoIGlkPSJYTUxJRF8zNThfIiBkPSJtMjQwIDQzNC4zNzh2NzUuNjIyaDE1bDUuODMzLTM1LjMzMy01LjgzMy0zOS42NjctNy41LTcuNjY3eiIgZmlsbD0iI2U2Mzk1MCIvPjxwYXRoIGlkPSJYTUxJRF8zNTVfIiBkPSJtMjcwIDQzNC4zNzgtNy41LTcuMDQ1LTcuNSA3LjY2N3Y3NWgxNWMwLTEyLjAwOSAwLTU2LjYzMiAwLTc1LjYyMnoiIGZpbGw9IiNjZDAwMDAiLz48cGF0aCBpZD0iWE1MSURfMzUyXyIgZD0ibTQzNC4zODEgMjcwaDc1LjYxOWMwLTEwLjQ5MiAwLTE5LjUwOCAwLTMwLTEyLjAwOSAwLTU2LjYyOSAwLTc1LjYxOSAwbC0xNC4zODEgMTV6IiBmaWxsPSIjY2QwMDAwIi8+PHBhdGggaWQ9IlhNTElEXzM0OV8iIGQ9Im03NS42MjIgMjcwYy0xOC45OSAwLTYzLjQzOSAwLTc1LjYyMiAwIDAtMTAuNDkyIDAtMTkuNTA4IDAtMzBoNzUuNjIxbDE0LjM3OSAxNXoiIGZpbGw9IiNlNjM5NTAiLz48cGF0aCBpZD0iWE1MSURfMzQ1XyIgZD0ibTc1IDI1NWMwIDk5LjI1IDgwLjc0NSAxODAgMTgwIDE4MGwxNS0xODAtMTUtMTgwYy05OS4yNSAwLTE4MCA4MC43NDUtMTgwIDE4MHoiIGZpbGw9IiNmZjYzN2IiLz48cGF0aCBpZD0iWE1MSURfMzQyXyIgZD0ibTQzNSAyNTVjMC05OS4yNDktODAuNzQ1LTE4MC0xODAtMTgwdjM2MGM5OS4yNDkgMCAxODAtODAuNzQ1IDE4MC0xODB6IiBmaWxsPSIjZTYzOTUwIi8+PHBhdGggaWQ9IlhNTElEXzMyN18iIGQ9Im0xMDUgMjU1YzAgODIuNzA3IDY3LjI4NyAxNTAgMTUwIDE1MGwxNS0xNTAtMTUtMTUwYy04Mi43MDggMC0xNTAgNjcuMjg3LTE1MCAxNTB6IiBmaWxsPSIjZTZmMmZmIi8+PHBhdGggaWQ9IlhNTElEXzMyM18iIGQ9Im00MDUgMjU1YzAtODIuNzA4LTY3LjI4Ny0xNTAtMTUwLTE1MHYzMDBjODIuNzA3IDAgMTUwLTY3LjI4OCAxNTAtMTUweiIgZmlsbD0iI2NkZiIvPjxwYXRoIGlkPSJYTUxJRF8zMjBfIiBkPSJtNDgwIDMwdjkwaDMwYzAtMTQuNTE4IDAtMTA1LjM4NiAwLTEyMC0xNC41MTggMC0xMDUuMzg2IDAtMTIwIDB2MzB6IiBmaWxsPSIjY2RmIi8+PHBhdGggaWQ9IlhNTElEXzMxNV8iIGQ9Im0zMCAxMjBjLTEwLjQ5MiAwLTE5LjUwOCAwLTMwIDAgMC0xNC41MTggMC0xMDUuMzg2IDAtMTIwaDEyMHYzMGMtMTAuODg5IDAtNzkuMDQgMC05MCAweiIgZmlsbD0iI2U2ZjJmZiIvPjxwYXRoIGlkPSJYTUxJRF8zMTJfIiBkPSJtNDgwIDQ4MGMtMTAuODg5IDAtNzkuMDQgMC05MCAwdjMwaDEyMGMwLTE0LjUxOCAwLTEwNS4zODYgMC0xMjAtMTAuNDkyIDAtMTkuNTA4IDAtMzAgMHoiIGZpbGw9IiNjZGYiLz48cGF0aCBpZD0iWE1MSURfMzA5XyIgZD0ibTEyMCA1MTBjLTE0LjUxOCAwLTEwNS4zODYgMC0xMjAgMCAwLTE0LjUxOCAwLTEwNS4zODYgMC0xMjBoMzB2OTBoOTB6IiBmaWxsPSIjZTZmMmZmIi8+PHBhdGggaWQ9IlhNTElEXzMwMF8iIGQ9Im0yMTMuNjc3IDIzNC44MjRjLTE0LjUwNSA3LjIwNi0yNC43NDYgMTYuNzItMzEuOTU0IDI2LjIwMi0xNC4zNzkgMTguOTE0LTE2LjY5MSAzNy42OTgtMTYuNzIzIDM3Ljc2NnYzMS4yMDhoOTBsMTUtMzcuNTAxLTE1LTM3LjUwMXoiIGZpbGw9IiM2Y2YiLz48cGF0aCBpZD0iWE1MSURfMjk2XyIgZD0ibTM0NSAyOTguNzkyYy0uMTAzLS4yMjQtMi4wMzQtMTguOTI3LTE2LjU1NS0zNy44NzEtNy4xODgtOS4zNzctMTcuNDYtMTguODEzLTMyLjEyMi0yNi4wOTZsLTQxLjMyMyAyMC4xNzN2MzcuNTAxIDM3LjUwMWg5MGMwLTEwLjkxNSAwLTIwLjI5MyAwLTMxLjIwOHoiIGZpbGw9IiM0NTk2ZTYiLz48cGF0aCBpZD0iWE1MSURfMjkyXyIgZD0ibTIwMi41IDIwMi41YzAgMjguOTQ4IDIzLjU1IDUyLjUgNTIuNSA1Mi41bDE1LTUyLjUtMTUtNTIuNWMtMjguOTQ4IDAtNTIuNSAyMy41NS01Mi41IDUyLjV6IiBmaWxsPSIjZmRjIi8+PHBhdGggaWQ9IlhNTElEXzI4N18iIGQ9Im0zMDcuNSAyMDIuNWMwLTI4Ljk0Ny0yMy41NS01Mi41LTUyLjUtNTIuNXYxMDVjMjguOTQ3IDAgNTIuNS0yMy41NSA1Mi41LTUyLjV6IiBmaWxsPSIjZmZiZmIzIi8+PC9nPjwvc3ZnPg=="},"design":{"board":"Python3-Noetic","graph":{"blocks":[{"id":"81c8302b-ddaf-4608-a2c2-d62e254e54d6","type":"basic.input","data":{"name":"Img"},"position":{"x":290,"y":353}},{"id":"3680762a-e4d0-4a2f-8315-22db96c2f120","type":"basic.input","data":{"name":"Enable"},"position":{"x":292,"y":594}},{"id":"cf5d2e26-5a50-4ff4-8b8f-43c582f1c655","type":"basic.output","data":{"name":"Out"},"position":{"x":1361,"y":470}},{"id":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","type":"basic.code","data":{"code":"import cv2\nimport numpy as np\nimport time\n\nclassName = []\nclassesFile = 'utils/models/yolov3/yolov3.txt'\n\nwith open(classesFile,'rt') as f:\n    className = f.read().rstrip('\\n').split('\\n')\n\ndef findObjects(outputs, img):\n\n    confThreshold = 0.3\n    nmsThreshold = 0.3\n    hT, wT, cT = img.shape\n    bbox = []\n    classIds = []\n    confs = []\n\n    for output in outputs:\n    \n        for det in output:\n            scores = det[5:]\n            classId = np.argmax(scores)\n            confidence = scores[classId]\n            if confidence > confThreshold:\n                w,h = int(det[2] * wT), int(det[3] * hT)\n                x,y = int((det[0]*wT) - w/2), int((det[1]*hT) - h/2)\n                bbox.append([x,y,w,h])\n                classIds.append(classId)\n                confs.append(float(confidence))\n    \n    indices = cv2.dnn.NMSBoxes(bbox, confs, confThreshold, nmsThreshold)\n    \n    for i in range(len(indices)):\n        box = bbox[i]\n        x,y,w,h = box[0],box[1],box[2],box[3]\n        cv2.rectangle(img,(x,y),(x+w, y+h),(255,0,255),2)\n        cv2.putText(img,f'{className[classIds[i]].upper()} {int(confs[i]*100)}%',\n                    (x,y-10),cv2.FONT_HERSHEY_SIMPLEX, 0.6, (255,0,255),2)\n           \ndef main(inputs, outputs, parameters, synchronise):\n    auto_enable = True\n    try:\n        enable = inputs.read_number(\"Enable\")\n    except Exception:\n        auto_enable = True\n    \n    whT = 320\n\n    modelConfiguration = 'utils/models/yolov3/yolov3-tiny.cfg'\n    modelWeights = 'utils/models/yolov3/yolov3-tiny.weights'\n\n    net = cv2.dnn.readNetFromDarknet(modelConfiguration,modelWeights)\n    net.setPreferableBackend(cv2.dnn.DNN_BACKEND_OPENCV)\n    net.setPreferableTarget(cv2.dnn.DNN_TARGET_CPU)\n\n    while(auto_enable or inputs.read_number('Enable')):\n        frame = inputs.read_image(\"Img\")\n        \n        if frame is None:\n            continue\n\n        #converting img to blob\n        blob = cv2.dnn.blobFromImage(frame, 1/255,(whT,whT),[0,0,0],1, crop = False)\n\n        #Passing blob to network\n        net.setInput(blob)\n\n        layerNames = net.getLayerNames()\n        outputNames = []\n        outLayers = net.getUnconnectedOutLayers()\n        \n        for i in range(len(outLayers)):\n            for j in range(len(outLayers[i])):\n                outputNames.append(layerNames[outLayers[i][j] - 1])\n\n        #forward Pass\n        results = net.forward(outputNames)\n        findObjects(results,frame)\n\n        outputs.share_image(\"Out\", frame)\n","frequency":"30","params":[],"ports":{"in":[{"name":"Img"},{"name":"Enable"}],"out":[{"name":"Out"}]},"size":{"width":"825px","height":"586px"}},"position":{"x":437,"y":136}}],"wires":[{"source":{"block":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","port":"Out","name":"Out"},"target":{"block":"cf5d2e26-5a50-4ff4-8b8f-43c582f1c655","port":"output-in","name":"output-in"}},{"source":{"block":"3680762a-e4d0-4a2f-8315-22db96c2f120","port":"input-out","name":"Enable"},"target":{"block":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","port":"Enable","name":"Enable"}},{"source":{"block":"81c8302b-ddaf-4608-a2c2-d62e254e54d6","port":"input-out","name":"Img"},"target":{"block":"3e8d8cac-cbdc-4f26-b98b-71bfbe2ff85e","port":"Img","name":"Img"}}]}},"dependencies":{}}